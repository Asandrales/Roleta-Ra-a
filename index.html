<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Roleta de RaÃ§as</title>

<style>
    body {
        background: #0c0c0c;
        font-family: Arial, sans-serif;
        text-align: center;
        color: white;
    }

    h1 {
        margin-top: 25px;
        font-size: 36px;
        text-shadow: 0 0 10px #ff7300;
    }

    .container {
        margin: auto;
        margin-top: 40px;
        width: 380px;
        padding: 20px;
        background: #1a1a1a;
        border-radius: 20px;
        box-shadow: 0 0 25px #ff6100aa;
    }

    .wheel-box {
        position: relative;
        width: 320px;
        height: 320px;
        margin: auto;
        background: #54350f;
        border-radius: 20px;
        padding-top: 15px;
        box-shadow: inset 0 0 20px #000;
    }

    canvas {
        border-radius: 50%;
        width: 290px;
        height: 290px;
        background: #000;
    }

    /* PONTEIRO */
    .ponteiro {
        position: absolute;
        top: -5px;
        left: 50%;
        transform: translateX(-50%);
        width: 0;
        height: 0;
        border-left: 18px solid transparent;
        border-right: 18px solid transparent;
        border-bottom: 30px solid white;
        filter: drop-shadow(0 0 5px #ffffff);
    }

    button {
        margin-top: 25px;
        background: #ff5c00;
        color: white;
        border: none;
        font-size: 20px;
        padding: 14px 28px;
        border-radius: 12px;
        cursor: pointer;
        font-weight: bold;
        transition: 0.2s;
        box-shadow: 0 0 10px #ff6a00;
    }

    button:hover {
        background: #ff7b00;
        box-shadow: 0 0 15px #ff8800;
    }

    /* Resultado */
    #resultado {
        margin-top: 25px;
        font-size: 22px;
        font-weight: bold;
        text-shadow: 0 0 10px white;
    }

</style>
</head>
<body>

<h1>ðŸŽ¡ Roleta de RaÃ§as</h1>

<div class="container">
    <div class="wheel-box">
        <div class="ponteiro"></div>
        <canvas id="wheel" width="300" height="300"></canvas>
    </div>

    <button onclick="girar()">Girar Roleta</button>
    <div id="resultado">â €</div>
</div>

<!-- SOM DE TICK -->
<audio id="tick" src="https://www.fesliyanstudios.com/play-mp3/387" preload="auto"></audio>

<script>
const racas = [
    { nome: "Humano",  chance: 40, cor: "#e6d6a3" },
    { nome: "Elfo",    chance: 25, cor: "#00ff44" },
    { nome: "AnÃ£o",    chance: 20, cor: "#8b4513" },
    { nome: "Bruxa",   chance: 10, cor: "#7a00ff" },
    { nome: "DemÃ´nio", chance: 5,  cor: "#ff3300" }
];

const canvas = document.getElementById("wheel");
const ctx = canvas.getContext("2d");

let setores = [];
let girando = false;
let anguloFinal = 0;

// Criar setores proporcionalmente Ã s chances
function calcularSetores() {
    let total = racas.reduce((a, b) => a + b.chance, 0);
    let acumulado = 0;

    setores = racas.map(r => {
        let inicio = (acumulado / total) * Math.PI * 2;
        acumulado += r.chance;
        let fim = (acumulado / total) * Math.PI * 2;
        return { nome: r.nome, cor: r.cor, inicio, fim };
    });
}

function desenhar() {
    ctx.clearRect(0, 0, 300, 300);
    ctx.save();
    ctx.translate(150, 150);
    ctx.rotate(anguloFinal);

    setores.forEach(s => {
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.fillStyle = s.cor;
        ctx.arc(0, 0, 140, s.inicio, s.fim);
        ctx.fill();

        // Texto
        ctx.save();
        ctx.fillStyle = "white";
        ctx.font = "bold 18px Arial";
        ctx.rotate(s.inicio + (s.fim - s.inicio) / 2);
        ctx.textAlign = "center";
        ctx.fillText(s.nome, 80, 10);
        ctx.restore();
    });

    ctx.restore();
}

calcularSetores();
desenhar();

function girar() {
    if (girando) return;
    girando = true;

    const ticks = 25;
    let count = 0;
    const tickSound = document.getElementById("tick");

    let rotInicial = anguloFinal;
    let rotExtra = Math.random() * Math.PI * 2;
    let rotTotal = (Math.PI * 6) + rotExtra;

    let inicio = Date.now();

    function animar() {
        let tempo = Date.now() - inicio;
        let p = Math.min(tempo / 3000, 1);

        anguloFinal = rotInicial + rotTotal * easeOut(p);

        if (count < ticks) {
            tickSound.currentTime = 0;
            tickSound.play();
            count++;
        }

        desenhar();

        if (p < 1) {
            requestAnimationFrame(animar);
        } else {
            girando = false;
            mostrarResultado(rotExtra);
        }
    }

    animar();
}

// animaÃ§Ã£o suave
function easeOut(t) {
    return 1 - Math.pow(1 - t, 4);
}

function mostrarResultado(rotExtra) {
    // Corrigir Ã¢ngulo para ponteiro no TOPO (add 90Â°)
    const ang = ((rotExtra + Math.PI / 2) % (Math.PI * 2) + Math.PI * 2) % (Math.PI * 2);

    for (const s of setores) {
        if (ang >= s.inicio && ang < s.fim) {
            document.getElementById("resultado").innerHTML = `âœ¨ VocÃª tirou: <span style="color:${s.cor};">${s.nome}</span>`;
            return;
        }
    }
}
</script>

</body>
</html>

